<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>HLS Media Sources Demo</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">

  <link rel="stylesheet" href="css/normalize.min.css">
  <link rel="stylesheet" href="css/main.css">

  <script src="js/vendor/modernizr-2.6.2.min.js"></script>
</head>
<body>
  <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
      <![endif]-->

  <div class="header-container">
    <header class="wrapper clearfix">
      <h1 class="title">Media Sources Demo</h1>
    </header>
  </div>

  <div class="main-container">
    <div class="main wrapper clearfix">

      <article>
        <header>
          <p>
            videojs-contrib-hls can convert MPEG transport streams
            into Media Source Extension-compatible media segments on
            the fly. Check out the demo below in Chrome!
          </p>
        </header>
        <section>
          <video id=demo width=640 height=360 controls>
            <p>
              Your browser is too old to view this demo. How about
              upgrading?
            </p>
          </video>
        </section>
      </article>

    </div> <!-- #main -->
  </div> <!-- #main-container -->

  <div class="footer-container">
    <footer class="wrapper">
    </footer>
  </div>


  <script src="zencoder-haze-1.js"></script>
  <!-- transmuxing -->
  <script>
    window.videojs = window.videojs || {
      Hls: {}
    };
  </script>
  <script src="../../src/stream.js"></script>
  <script src="../../src/mp4-generator.js"></script>
  <script src="../../src/transmuxer.js"></script>
  <script src="../../src/exp-golomb.js"></script>
  <script src="js/mp4-inspector.js"></script>

  <script src="../../src/bin-utils.js"></script>
  <script>
    var mediaSource = new MediaSource(),
        demo = document.getElementById('demo');

    // setup the media source
    mediaSource.addEventListener('sourceopen', function() {
      var videoBuffer = mediaSource.addSourceBuffer('video/mp4;codecs=avc1.4d400d'),
          audioBuffer = mediaSource.addSourceBuffer('audio/mp4;codecs=mp4a.40.2'),
          transmuxer = new videojs.mp2t.Transmuxer(),
          videoSegments = [],
          audioSegments = [];

      // expose the machinery for debugging
      window.vjsMediaSource = mediaSource;
      window.vjsSourceBuffer = videoBuffer;
      window.vjsVideo = demo;

      // transmux the MPEG-TS data to BMFF segments
      transmuxer.on('data', function(segment) {
        if (segment.type === 'video') {
          videoSegments.push(segment);
        } else {
          audioSegments.push(segment);
        }
      });
      transmuxer.push(hazeVideo);
      transmuxer.end();

      // buffer up the video data
      videoBuffer.appendBuffer(videoSegments.shift().data);
      videoBuffer.addEventListener('updateend', function() {
        if (videoSegments.length) {
          videoBuffer.appendBuffer(videoSegments.shift().data);
        }
      });

      // buffer up the audio data
      audioBuffer.appendBuffer(audioSegments.shift().data);
      audioBuffer.addEventListener('updateend', function() {
        if (audioSegments.length) {
          audioBuffer.appendBuffer(audioSegments.shift().data);
        }
      });
    });
    demo.src = URL.createObjectURL(mediaSource);
    demo.addEventListener('error', console.log.bind(console));
  </script>
</body>
</html>
